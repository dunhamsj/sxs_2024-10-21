%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Beamer Presentation
% LaTeX Template
% Version 1.0 (10/11/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%------------------------------------------------------------------------------%
%	PACKAGES AND THEMES
%------------------------------------------------------------------------------%

\documentclass{beamer}

\input{preamble.tex}
\input{customCommands.tex}

% --- TITLE PAGE SLIDE ---

\title[SXS Group Meeting]{\thornado-Hydro (xCFC)}

\author{Samuel J. Dunham}
\date{October 21, 2024}

\begin{document}

\begin{frame}

  \maketitle

\end{frame}

\begin{frame}

  \begin{figure}[ht]
    \centering
    \includegraphics[width=0.3\textwidth]{fig.thornado_logo.png}
  \end{figure}

  \begin{center}

    \ul{t}oolkit for
    \ul{h}igh-\ul{or}der
    \ul{n}eutrino-r\ul{ad}iation hydr\ul{o}dynamics\\[1em]
    \url{https://github.com/endeve/thornado}\\[1em]

  \end{center}

  \Fontvi

  \begin{columns}[c]

    \column{0.5\textwidth}

      \begin{itemize}
        \item
          DG
        \item
          SSPRK/IMEX\footnote{\citet{ceh2019}}
        \item
          GR (xCFC)
        \item
          Hydro\footnote{\citet{ebd2019,dem2020,pbe2021}}
          (Valencia)
        \item
          Neutrino transport\footnote{\citet{lec2021,leh2025}} (M1)
        \item
          Interfaces to tabulated EoS/Opacities
          (weaklib: \url{https://github.com/starkiller-astro/weaklib})
      \end{itemize}

    \column{0.5\textwidth}

      \vspace{-6em}
      \begin{itemize}
        \item
          Fluid self-gravity via \poseidon:
          \url{https://github.com/jrober50/Poseidon}
        \item
          GPUs via OpenACC or OpenMP pragmas
        \item
          MPI parallelism and AMR via \amrex:
          \url{https://github.com/AMReX-Codes/amrex}
      \end{itemize}

  \end{columns}

\end{frame}

\begin{frame}
\frametitle{Motivation}

  \begin{itemize}
    \item
      Capturing diffusion limit for neutrino transport without
      ad-hoc methods
    \item
      High-order accuracy on a compact stencil
    \item
      An alternative simulation code than the standard FV/FD methods
    \item
      An experiment in applied math:
      are DG methods effective for CCSN simulations?
  \end{itemize}

\end{frame}

\section{Mathematical Model}

\begin{frame}
\frametitle{3+1 Decomposition}

  \begin{figure}[htb!]
    \centering
    \includegraphics[width=0.7\textwidth]{fig.1p1.png}
  \end{figure}

  \vspace{-2em}

  \begin{equation*}
    ds^{2}
    =g_{\mu\nu}\,dx^{\mu}\,dx^{\nu}
    =-\alpha^{2}\,dt^{2}
     +\gamma_{ij}\left(dx^{i}+\beta^{i}\,dt\right)
                 \left(dx^{j}+\beta^{j}\,dt\right)
  \end{equation*}

\end{frame}

\begin{frame}
\frametitle{Conformally-Flat Condition}

  \begin{columns}[c]

    \column{.5\textwidth}

      Developed by \citet{wmm1996}, extended by \citet{cc2009}

      \begin{align*}
        \gamma_{ij}\left(x\right)
        &=\psi^{4}\left(x\right)\,\overline{\gamma}_{ij}\left(x^{i}\right) \\
        K&=0,\ \p_{t}\,K=0 \\
        &\hspace{-3em}\mathrm{(Always\ and\ everywhere)}
      \end{align*}\vspace{1em}

      \begin{itemize}
        \item Exact in spherical symmetry!
        \item Hyperbolic $\rightarrow$ Elliptic equations
        \item Good for long-time simulations
      \end{itemize}

    \column{.5\textwidth}

      Special case: Schwarzchild spacetime in isotropic coordinates
      ($G=c=1$)

      \begin{align*}
        \alpha
          &=\left(1+\frac{1}{2}\,\Phi\right)
            \left(1-\frac{1}{2}\,\Phi\right)^{-1} \\
        \psi
          &=1-\frac{1}{2}\,\Phi \\
        \beta^{i}
          &=0,
      \end{align*}
      with
      \begin{equation*}
        \Phi\left(r\right):=-\frac{M}{r}
      \end{equation*}

  \end{columns}

\end{frame}

\section{Numerical Methods}

\begin{frame}
\frametitle{Discontinuous Galerkin (DG) Method}

  \begin{figure}
    \begin{overprint}
      \onslide<1>
        \centering\includegraphics[width=0.8\textwidth]{./fig.sine.png}
      \onslide<2>
        \centering\includegraphics[width=0.8\textwidth]{./fig.sine_k0.png}
      \onslide<3>
        \centering\includegraphics[width=0.8\textwidth]{./fig.sine_k1.png}
      \onslide<4>
        \centering\includegraphics[width=0.8\textwidth]{./fig.sine_k2.png}
      \onslide<5>
        \centering\includegraphics[width=0.8\textwidth]{./fig.sine_k2_box.png}
    \end{overprint}
  \end{figure}

\end{frame}

\begin{frame}
\frametitle{Discontinuous Galerkin (DG) Method}

  \Fontvi

  \begin{equation*}
    \mathbb{P}^{k} \ni u_{h}\left(x,t\right)
    :=\sum\limits_{i=1}^{k+1}
      u_{i}\left(t\right)\,\ell_{i}\left(x\right)
  \end{equation*}

  \begin{figure}[htb!]
    \centering
    \includegraphics[width=0.7\textwidth]{fig.DG_1D.png}
  \end{figure}

\end{frame}

\begin{frame}
\frametitle{Time Stepping}

  \begin{itemize}
    \item
      For hydro-only, strong-stabililty-preserving Runge--Kutta (SSPRK)
      methods
      \begin{itemize}
        \item
          Convex combinations of forward-Euler timesteps
      \end{itemize}
    \item
      For hydro+neutrinos, realizability-preserving ImEx methods
      (\citet{ceh2019})
  \end{itemize}

\end{frame}

\begin{frame}

  \begin{figure}[htb!]
    \centering
    \includegraphics[width=0.8\textwidth]{fig.ConvergenceRates.png}
  \end{figure}

\end{frame}

%\begin{frame}
%\frametitle{Slope Limiter (MinMod)}
%
%  \centering
%  \animategraphics[width=0.8\textwidth,step,controls] %
%  {1}{fig.sl_0}{0}{7}
%
%\end{frame}

\begin{frame}
\frametitle{Slope Limiter (MinMod)}

  \begin{figure}
    \begin{overprint}
      \onslide<1>
        \centering\includegraphics[width=0.8\textwidth]{./fig.sl_00.png}
      \onslide<2>
        $k = 9$

        \centering\includegraphics[width=0.8\textwidth]{./fig.sl_01.png}
      \onslide<3>
        \centering\includegraphics[width=0.8\textwidth]{./fig.sl_02.png}
      \onslide<4>
        $$\bar{u}\left(t\right)
        := \frac{1}{V_{h}\left(t\right)} \,
        \int_{K} u_{h}\left(x,t\right) \,
        \sqrt{\gamma_{h}}\left(x,t\right) \, dx,
        \ V_{h}\left(t\right)
        := \int_{K} \sqrt{\gamma_{h}}\left(x,t\right) \, dx$$
        \centering\includegraphics[width=0.7\textwidth]{./fig.sl_03.png}
      \onslide<5>
        $$u_{h}\left(x,t\right)
        = \sum\limits_{i=1}^{k+1} u_{i}\left(t\right) \, \ell_{i}\left(x\right)
        = \sum\limits_{n=0}^{k} C_{n}\left(t\right) \, P_{n}\left(x\right)$$
        \centering\includegraphics[width=0.7\textwidth]{./fig.sl_04.png}
      \onslide<6>
        $$\textcolor{red}{a:=\bar{u}_{K}-\bar{u}_{K-1}}\hspace{2em}
          \textcolor{blue}{b:=\bar{u}_{K+1}-\bar{u}_{K}}$$
        \centering\includegraphics[width=0.7\textwidth]{./fig.sl_05.png}
      \onslide<7>
        \Fontvi
        $$\tilde{C}_{1} := \mathrm{minmod}\left(a,b,C_{1}\right),$$
        $$\mathrm{minmod}\left(a,b,C_{1}\right)
        := \begin{cases}
             \mathrm{sgn}\left(a\right)\times
             \min\left(\left|a\right|,\left|b\right|,\left|C_{1}\right|\right),
             & \mathrm{sgn}\left(a\right)=\mathrm{sgn}\left(b\right)
               =\mathrm{sgn}\left(C_{1}\right) \\
             0, & \mathrm{else}
           \end{cases}$$
        \centering\includegraphics[width=0.7\textwidth]{./fig.sl_05.png}
      \onslide<8>
        $$\sum\limits_{n=1}^{k}C_{n} \, P_{n} = u_{h}
        \to \tilde{u}_{h} := \Lambda_{\textsc{sl}}\left(u_{h}\right)
        := C_{0} \, P_{0} + \tilde{C}_{1} \, P_{1}$$
        \centering\includegraphics[width=0.7\textwidth]{./fig.sl_06.png}
      \onslide<9>
        $k = 9$

        $\tilde{k} = 1$

        \centering\includegraphics[width=0.8\textwidth]{./fig.sl_07.png}
    \end{overprint}
  \end{figure}

\end{frame}

\begin{frame}
\frametitle{Troubled Cell Indicator \citep{fs2017}}

  \begin{figure}
    \begin{overprint}
      \onslide<1>
        \centering\includegraphics[width=0.8\textwidth]{./fig.tci_00.png}
      \onslide<2>
        $k = 2$

        \centering\includegraphics[width=0.8\textwidth]{./fig.tci_01.png}
      \onslide<3>
        \centering\includegraphics[width=0.7\textwidth]{./fig.tci_02.png}
      \onslide<4>
        \textcolor{red}{$u_{h}\left(x,t\right)
        = \sum\limits_{i=1}^{k+1} u_{i} \, \ell_{i}\left(x\right)$},
        \textcolor{blue}{$u_{h}\left(x,t\right)
        = \sum\limits_{i=1}^{k+1} u_{i} \, \ell_{i}\left(x\right)$}

        \centering\includegraphics[width=0.7\textwidth]{./fig.tci_03.png}
      \onslide<5>
        \centering\includegraphics[width=0.7\textwidth]{./fig.tci_04.png}
      \onslide<6>
        $I_{K} :=
        \left(\max\limits_{j\in\left\{0,\cdots,2^{d}\right\}}
        \left(\left|\bar{u}_{j}\right|\right)\right)^{-1}
        \sum\limits_{j=1}^{2^{d}}
        \left|\bar{u}_{0}-\bar{\bar{u}}_{j}\right|$

        \centering\includegraphics[width=0.7\textwidth]{./fig.tci_05.png}
    \end{overprint}
  \end{figure}

\end{frame}


\newcommand{\lbel}{\Lambda_{\textsc{bel}}}
\begin{frame}
\frametitle{Bound-Enforcing Limiter ($\lbel$)}

  \begin{itemize}
    \item
      Proposed in \citet{qsy2016}
    \item
      Define $\mathcal{G}$ as the set of physically-admissible states;
      i.e., positivite density and energy density, subluminal fluid velocity
      (for an ideal EoS, $\mathcal{G}$ is convex)
  \end{itemize}

  \begin{figure}
    \centering
    \begin{tikzpicture}
      \filldraw[color=black,fill=cyan!20,very thick] %
       (0,0) ellipse (1.5 and 1.0) %
        node at (-1,0.2) {\large $\mathcal{G}$};
      \filldraw[black] (-0.5,0) circle (1pt) %
        node at (-0.7,-0.2) {$\bar{u}$};
      \filldraw[black] (1.5,-0.5) circle (1pt) %
        node at (1.7,-0.7) {$u_{1}$};
      \filldraw[black] (0.8,0.3) circle (1pt) %
        node at (0.6,0.5) {$u_{2}$};
      \draw node at (0.0,-1.5) %
        {$u_{h} = u_{1} \, \ell_{1} + u_{2} \, \ell_{2}$};
      \draw[thick,->] (2.4,0.0) -- (5.0,0.0) %
        node at (3.8,0.2) {$\lbel$};
      \filldraw[color=black,fill=cyan!20, very thick] %
        (7,0) ellipse (1.5 and 1.0) %
        node at (6,0.2) {\large $\mathcal{G}$};
      \filldraw[black] (6.5,0) circle (1pt) %
        node at (6.3,-0.2) {$\bar{u}$};
      \filldraw[black,opacity=0.5] (8.5,-0.5) circle (1pt) %
        node at (8.7,-0.7) {$u_{1}$};
      \filldraw[black] (8.2,-0.45) circle (1pt) %
        node at (8.0,-0.45) {$\tilde{u}_{1}$};
      \filldraw[black,opacity=0.5] (7.8,0.3) circle (1pt) %
        node at (7.6,0.5) {$u_{2}$};
      \filldraw[black] (7.4,0.2) circle (1pt) %
        node at (7.2,0.4) {$\tilde{u}_{2}$};
      \draw node at (7.0,-1.5) %
        {$\tilde{u}_{h} := \lbel\left(u_{h}\right)
        = \tilde{u}_{1} \, \ell_{1} + \tilde{u}_{2} \, \ell_{2}$};
    \end{tikzpicture}
  \end{figure}

\end{frame}

\begin{frame}
\frametitle{Standing Accretion Shock Instability}

  Used \thornado\ to investigate the role of GR on the SASI%
  \footnote{\citet{dem2020,dem2024}}

  \begin{columns}[c]

    \column{.6\textwidth}

      \begin{figure}[htb!]
        \centering
        \includegraphics[width=0.9\textwidth]{fig.sasi.png}
      \end{figure}

    \column{.4\textwidth}

      \begin{figure}[htb!]
        \centering
        \includegraphics[width=0.9\textwidth]{fig.sasi_GRvNR.pdf}
      \end{figure}

  \end{columns}

\end{frame}

\begin{frame}
\frametitle{Mesh Refinement with AMReX}

  \begin{figure}[htb!]
    \centering
    \includegraphics[width=0.7\textwidth]{amrex.png}
  \end{figure}

  \begin{center}
    \url{https://github.com/AMReX-Codes/amrex}
  \end{center}

\end{frame}

\begin{frame}
\frametitle{Interpolation}

  \begin{columns}[c]

    \column{0.4\textwidth}

      \begin{figure}[htb!]
        \centering
        \includegraphics[width=0.9\textwidth]{fig.amrElement.png}
      \end{figure}

    \column{0.6\textwidth}

    Given $U_{h}\left(x,t\right)
    = \sum\limits_{i\in\mathcal{N}} U_{i}\left(t\right) \,
    \ell_{i}\left(x\right)$,
    how to compute \textcolor{blue}{$u_{h}^{\left(j\right)}\left(x,t\right)
    = \sum\limits_{i\in\mathcal{N}}
    u_{i}^{\left(j\right)}\left(t\right) \,
    \ell_{i}^{\left(j\right)}\left(x\right)$},
    or vice-versa?
    ($\mathcal{N}$ is the set of all grid-points for any given element.)

  \end{columns}

\end{frame}

\begin{frame}
\frametitle{Conservative Interpolation}

  \begin{columns}[c]

    \column{0.4\textwidth}

      \begin{figure}[htb!]
        \centering
        \includegraphics[width=0.9\textwidth]{fig.amrElement.png}
      \end{figure}

    \column{0.6\textwidth}

      \begin{itemize}
        \item
          \citet{sbc2015}
      \end{itemize}

      Given a solution on a coarse element $K$, $U_{h}$,
      define the solution on the $j$th ($j\in\left\{1,\cdots,2^{d}\right\}$)
      fine element $k^{\left(j\right)}$,
      \textcolor{blue}{$u_{h}^{\left(j\right)}$}
      via the minimization of an $L^{2}$-projection:

      $$\forall i \in \mathcal{N}:
      \min\limits_{\textcolor{blue}{\tilde{u}_{i}^{\left(j\right)}}}
      \int_{k^{\left(j\right)}}\left(\tilde{U}_{h}
      -\textcolor{blue}{\tilde{u}_{h}^{\left(j\right)}}\right)^{2}d^{d}x,$$

      where $\tilde{U} := \sqrt{\gamma} \, U$.
      For the geometry fields, we use the same procedure but do not pre-multiply
      with $\sqrt{\gamma}$.

  \end{columns}

\end{frame}

\begin{frame}
\frametitle{Flux Corrections}

  \begin{figure}[htb!]
    \centering
    \includegraphics[width=0.7\textwidth]{fig.MeshRefinement_2D.png}
  \end{figure}

\end{frame}

\begin{frame}
\frametitle{Flux Corrections}

  \begin{columns}[c]

    \column{0.4\textwidth}

      \begin{figure}[htb!]
        \centering
        \includegraphics[width=0.9\textwidth]{fig.amrElement_facePoints.png}
      \end{figure}

    \column{0.6\textwidth}

      The numerical flux across, say,
      the $x^{1}$ interface on the right side of an
      element for a 2D problem with no gravity and Cartesian coordinates
      is given by

      \Fontvi

      \begin{align*}
        &\int_{K^{2}} \widehat{F}^{1}\left(U_{h}^{-},U_{h}^{+}\right) \,
        \ell_{k_{1}}\left(x^{1}_{\textsc{h}}\right) \,
        \ell_{k_{2}}\left(x^{2}\right) \, dx^{2} \\
        &= \sum\limits_{j\in\left\{2,4\right\}}
        \int_{k_{\left(j\right)}^{2}}
        \widehat{F}^{1}\left(U_{h}^{-},U_{h}^{+}\right) \,
        \ell_{k_{1}}\left(x^{1}_{\textsc{h}}\right) \,
        \ell_{k_{2}}\left(x^{2}\right) \, dx^{2} \\
        &:= \sum\limits_{j\in\left\{2,4\right\}}
        \int_{k_{\left(j\right)}^{2}}
        \widehat{F}^{1}\left(u^{\left(j\right),-}_{h},
        u^{\left(j\right),+}_{h}\right) \,
        \ell_{k_{1}}\left(x^{1}_{\textsc{h}}\right) \,
        \ell_{k_{2}}\left(x^{2}\right) \, dx^{2}
      \end{align*}

  \end{columns}

\end{frame}

\begin{frame}
\frametitle{Kelvin--Helmholtz Instability}

  \begin{center}
    {\includegraphics[width=0.6\textwidth]{fig.KHI.pdf}}
  \end{center}

\end{frame}

\begin{frame}
\frametitle{2D Blast Wave \citep{db2002}}

  \begin{center}
    \includegraphics[width=0.3\textwidth]%
      {fig.dZB2002_256x256.pdf}\hfill%
    \includegraphics[width=0.3\textwidth]%
      {fig.dZB2002_032x032_AMR.pdf}\hfill%
    \includegraphics[width=0.3\textwidth]%
      {fig.dZB2002_032x032_AMR_Mesh.pdf}
  \end{center}

\end{frame}

\begin{frame}
\frametitle{Adiabatic Collapse (Collapse Phase)}

  \begin{figure}[htb!]
    \centering
    \includegraphics[width=0.8\textwidth]{fig.collapse.pdf}
  \end{figure}

\end{frame}

\begin{frame}
\frametitle{Adiabatic Collapse (Post-Bounce Phase)}

  \begin{figure}[htb!]
    \centering
    \includegraphics[width=0.8\textwidth]{fig.postBounce.pdf}
  \end{figure}

\end{frame}

\begin{frame}
\frametitle{Bibliography}

  \Fontvii
  \bibliography{bibfile.bib}

\end{frame}

\begin{frame}
\frametitle{Summary}

  \begin{tabular}{cl}
    \begin{tabular}{l}
      \parbox{0.7\linewidth}%
      {Can run multi-D pure hydro problems in GR with AMR}
    \end{tabular}
    \begin{tabular}{c}
      \includegraphics[width=0.15\textwidth]{fig.KHI.pdf}
    \end{tabular}
  \end{tabular}

  \begin{tabular}{cl}
    \begin{tabular}{c}
      \includegraphics[width=0.2\textwidth]{fig.Collapse.png}
    \end{tabular}
    \begin{tabular}{l}
      \parbox{0.7\linewidth}%
      {Can run 1D hydro+self-gravity problems in GR with AMR}
    \end{tabular}
  \end{tabular}

  \vspace{1em}

  Working on coupling GR transport to existing hydro+gravity modules

\end{frame}

\end{document}
%------------------------------------------------------------------------------%
